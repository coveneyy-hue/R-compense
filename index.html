<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Gestion des dÃ©penses enfants</title>
<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
    }
    header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px;
        border-bottom: 1px solid #ddd;
    }
    .child-btn {
        padding: 6px 12px;
        border-radius: 6px;
        border: 1px solid #999;
        background: #f4f4f4;
        cursor: pointer;
    }
    .child-btn.active {
        background: #1976d2;
        color: white;
        border-color: #1976d2;
    }
    .save-icon {
        margin-left: auto;
        cursor: pointer;
        font-size: 20px;
        user-select: none;
    }
    .save-icon:hover {
        opacity: 0.7;
    }
</style>
</head>

<body>

<header>
    <button id="btnLily" class="child-btn active">Lily-Rose</button>
    <button id="btnVictor" class="child-btn">Victor</button>

    <!-- IcÃ´ne Enregistrer -->
    <span id="saveBtn" class="save-icon" title="Enregistrer">ðŸ’¾</span>
</header>

<script>
/* ===========================
   DonnÃ©es et contexte
=========================== */
let currentChild = "Lily-Rose";
let data = {
    transactions: []
};

/* ===========================
   UI enfants
=========================== */
document.getElementById("btnLily").onclick = () => setChild("Lily-Rose");
document.getElementById("btnVictor").onclick = () => setChild("Victor");

function setChild(name) {
    currentChild = name;
    document.getElementById("btnLily").classList.toggle("active", name === "Lily-Rose");
    document.getElementById("btnVictor").classList.toggle("active", name === "Victor");
}

/* ===========================
   Enregistrement
=========================== */
document.getElementById("saveBtn").onclick = saveTransaction;

function saveTransaction() {
    const categorie = "Ã‰cole"; // exemple
    const note = 85;           // exemple
    const moyenne = 82;        // exemple
    const date = new Date();   // exemple

    if (categorie === "Ã‰cole") {
        const duplicate = data.transactions.find(t =>
            t.enfant === currentChild &&
            t.categorie === "Ã‰cole" &&
            t.note === note &&
            t.moyenne === moyenne &&
            Math.abs(new Date(t.date) - date) <= 31 * 24 * 60 * 60 * 1000
        );

        if (duplicate) {
            const ok = confirm(
                `Doublon potentiel "Pour ${currentChild}, il y a dÃ©jÃ  une note et une moyenne identique saisie Ã  ${formatDate(duplicate.date)}". Voulez-vous tout de mÃªme continuer ?`
            );
            if (!ok) return;
        }
    }

    data.transactions.push({
        enfant: currentChild,
        categorie,
        note,
        moyenne,
        date: date.toISOString()
    });

    saveData();

    // âœ… MESSAGE AJOUTÃ‰ ICI
    showToast("Enregistrement complÃ©tÃ©");
}

/* ===========================
   Persistance
=========================== */
function saveData() {
    localStorage.setItem("data", JSON.stringify(data));
}

/* ===========================
   Toast message
=========================== */
function showToast(message) {
    const toast = document.createElement("div");
    toast.textContent = message;
    toast.style.position = "fixed";
    toast.style.top = "16px";
    toast.style.right = "16px";
    toast.style.padding = "10px 14px";
    toast.style.background = "#2e7d32";
    toast.style.color = "white";
    toast.style.borderRadius = "6px";
    toast.style.zIndex = 1000;
    toast.style.fontSize = "14px";
    toast.style.boxShadow = "0 2px 6px rgba(0,0,0,0.2)";

    document.body.appendChild(toast);

    setTimeout(() => toast.remove(), 2000);
}

/* ===========================
   Utilitaires
=========================== */
function formatDate(d) {
    const dt = new Date(d);
    return dt.toISOString().substring(0, 10);
}
</script>

</body>
</html>
